{"remainingRequest":"/Users/weizhang/JAVASHOP/vue-admin-template-master/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/weizhang/JAVASHOP/vue-admin-template-master/src/module/home/components/book/bookPreview.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/weizhang/JAVASHOP/vue-admin-template-master/src/module/home/components/book/bookPreview.vue","mtime":1565796161000},{"path":"/Users/weizhang/JAVASHOP/vue-admin-template-master/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/weizhang/JAVASHOP/vue-admin-template-master/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/weizhang/JAVASHOP/vue-admin-template-master/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/weizhang/JAVASHOP/vue-admin-template-master/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n\n// 属性：\n// author:lx 2018-08-06\nimport pdfjsLib from 'pdfjs-dist'\nimport $ from 'jquery'\nexport default {\n\tname: 'ReadByPdf',\n\tdata() {\n\t\treturn {\n\t\t\ttheReadOnline: {\n\t\t\t\tcurrent: 1,\n\t\t\t\tnumPages: 0,\n\t\t\t},\n\t\t}\n\t},\n\tcomputed:{\n\t\tcurrentUrl:function(){\n\t\t\treturn this.url;\n\t\t}\n\t},\n\tmethods: {\n\t\t// 初始化pdfjs\n\t\tinitThePDFJSLIB: function() {\n\t\t\tpdfjsLib.GlobalWorkerOptions.workerSrc = 'pdfjs-dist/build/pdf.worker.js'\n\t\t},\n\t\t// 根据页码获取pdf内容\n\t\tloadPDFForTheDocument(index) {\n\t\t\t// 实例化pdfjs\n\t\t\tpdfjsLib.getDocument(this.url).then(pdf => {\n\t\t\t\t// 通过页码获取每页内容\n\t\t\t\tpdf.getPage(index).then(page => {\n\t\t\t\t\t// 获得总页数\n\t\t\t\t\tthis.theReadOnline.numPages = pdf.numPages\n\t\t\t\t\t// 设置页面显示倍数 842×595\n\t\t\t\t\t//let _clientWidth = document.documentElement.clientWidth * 0.618\n\t\t\t\t\t//let view = _clientWidth % 842 > 0 ? 1.33 : 1\n\t\t\t\t\tlet view=0.85;\n\t\t\t\t\t// 实例化画布\n\t\t\t\t\tlet canvas = document.createElement('canvas')\n\t\t\t\t\tlet context = canvas.getContext('2d')\n\t\t\t\t\tlet dpr = window.devicePixelRatio || 1\n\t\t\t\t\tlet bsr = context.webkitBackingStorePixelRatio ||\n\t\t\t\t\t\tcontext.mozBackingStorePixelRatio ||\n\t\t\t\t\t\tcontext.msBackingStorePixelRatio ||\n\t\t\t\t\t\tcontext.oBackingStorePixelRatio ||\n\t\t\t\t\t\tcontext.backingStorePixelRatio || 1\n\t\t\t\t\tlet ratio = dpr / bsr\n\t\t\t\t\tratio=1;\n\t\t\t\t\tlet viewport = page.getViewport(view)\n\t\t\t\t\tcanvas.width = viewport.width * ratio\n\t\t\t\t\tcanvas.height = viewport.height * ratio\n\t\t\t\t\t// canvas.style.width = viewport.width + 'px'\n\t\t\t\t\t// canvas.style.height = viewport.height + 'px'\n\t\t\t\t\t// context.setTransform(ratio, 0, 0, ratio, 0, 0)\n\t\t\t\t\tlet renderContext = {\n\t\t\t\t\t\tcanvasContext: context,\n\t\t\t\t\t\tviewport: viewport\n\t\t\t\t\t}\n\t\t\t\t\t// 追加上新的一页空间\n\t\t\t\t\tdocument.getElementById('div_read_area').appendChild(canvas)\n\t\t\t\t\t// 赋值上显示内容\n\t\t\t\t\tpage.render(renderContext).then(() => {\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t}).catch(err => {\n\t\t\t\tconsole.log(err)\n\t\t\t})\n\t\t},\n\t\twatchTheReadScroll: function() {\n\t\t\tlet _theVue = this\n\t\t\t// 获取节点\n\t\t\tlet _scrollContent = document.getElementById('div_read_area_scrool')\n\t\t\t// 绑定事件\n\t\t\t_scrollContent.addEventListener('scroll', function() {\n\t\t\t\tvar viewH, contentH, scrollTop\n\t\t\t\tviewH = $(this).height()\n\t\t\t\tcontentH = $(this).get(0).scrollHeight\n\t\t\t\tscrollTop = $(this).scrollTop()\n\t\t\t\t// 后期改成传递给父级\n\t\t\t\tif (scrollTop / (contentH - viewH) >= 1) { // 到达底部时,加载新内容\n\t\t\t\t\t_theVue.theReadOnline.current++\n\t\t\t\t\tif (_theVue.theReadOnline.current <= _theVue.theReadOnline.numPages) {\n\t\t\t\t\t\t_theVue.loadPDFForTheDocument(_theVue.theReadOnline.current)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t},\n\tmounted: function() {\n\t\tthis.initThePDFJSLIB()\n\t\tthis.watchTheReadScroll()\n\t\tthis.loadPDFForTheDocument(1)\n\t},\n\tprops:{\n\t\turl:{\n\t\t\ttype:String\n\t\t}\n\t},\n\twatch:{\n\t\tcurrentUrl:function(){\n\t\t\t$(document.getElementById('div_read_area')).html(\"\");\n\t\t\tthis.loadPDFForTheDocument(1)\n\t\t}\n\t}\n}\n",null]}