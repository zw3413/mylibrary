{"remainingRequest":"/Users/weizhang/JAVASHOP/vue-admin-template-master/node_modules/babel-loader/lib/index.js!/Users/weizhang/JAVASHOP/vue-admin-template-master/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/weizhang/JAVASHOP/vue-admin-template-master/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/weizhang/JAVASHOP/vue-admin-template-master/src/module/viewer/page/txt.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/weizhang/JAVASHOP/vue-admin-template-master/src/module/viewer/page/txt.vue","mtime":1578067146000},{"path":"/Users/weizhang/JAVASHOP/vue-admin-template-master/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/weizhang/JAVASHOP/vue-admin-template-master/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/weizhang/JAVASHOP/vue-admin-template-master/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/weizhang/JAVASHOP/vue-admin-template-master/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"/Users/weizhang/JAVASHOP/vue-admin-template-master/node_modules/@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _objectSpread2 = _interopRequireDefault(require(\"/Users/weizhang/JAVASHOP/vue-admin-template-master/node_modules/@babel/runtime-corejs2/helpers/objectSpread2\"));\n\nrequire(\"core-js/modules/es6.regexp.split\");\n\nvar _vue = _interopRequireDefault(require(\"vue\"));\n\nvar _vuex = require(\"vuex\");\n\nvar _axios = _interopRequireDefault(require(\"axios\"));\n\nvar _local = _interopRequireDefault(require(\"@/store/local\"));\n\nvar _TopNav = _interopRequireDefault(require(\"../component/TopNav\"));\n\nvar _BottomNav = _interopRequireDefault(require(\"../component/BottomNav\"));\n\nvar _FontNav = _interopRequireDefault(require(\"../component/FontNav\"));\n\nvar _Cover = _interopRequireDefault(require(\"../component/Cover\"));\n\nvar _Loading = _interopRequireDefault(require(\"../component/Loading\"));\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//   import ListPanel from '../component/ListPanel';\nvar _default = {\n  data: function data() {\n    return {\n      bar: false,\n      timer: null,\n      title: '',\n      content: [],\n      loading: false,\n      showList: false,\n      booksReadInfo: {}\n    };\n  },\n  components: {\n    TopNav: _TopNav.default,\n    BottomNav: _BottomNav.default,\n    FontNav: _FontNav.default,\n    //      ListPanel,\n    Cover: _Cover.default,\n    Loading: _Loading.default\n  },\n  created: function created() {\n    // //判断本地是否存储了阅读器文字大小\n    // if (localEvent.StorageGetter('fz_size')) {\n    //     this.$store.state.fz_size = localEvent.StorageGetter('fz_size');\n    // }\n    // //判断本地是否存储了阅读器主题色\n    // if (localEvent.StorageGetter('bg_color')) {\n    //     this.$store.state.bg_color = localEvent.StorageGetter('bg_color');\n    // }\n    // //加载时从localStorage中回去所有数据阅读进度\n    // const localBookReaderInfo = localEvent.StorageGetter('bookreaderinfo');\n    // let id = this.$route.params.id;\n    // //当前书籍以前读过并有阅读进度\n    // if (localBookReaderInfo && localBookReaderInfo[id]) {\n    //     this.booksReadInfo = localEvent.StorageGetter('bookreaderinfo');\n    //     //this.getData(id, this.booksReadInfo[id].chapter);\n    //     this.$store.dispatch('curChapter', this.booksReadInfo[id].chapter);\n    // } else {\n    //     //当前书籍没有读过但是localStorage保存了其他书籍进度\n    //     if (localBookReaderInfo) {\n    //         this.booksReadInfo = localBookReaderInfo;\n    //         this.getData(id, 1);\n    //         this.$store.dispatch('curChapter', 1);\n    //     } else {\n    //         //第一次进入阅读\n    //         this.booksReadInfo[id] = {\n    //             book: id,\n    //             chapter: 1,\n    //         };\n    //         this.getData(id, 1);\n    //         this.$store.dispatch('curChapter', 1);\n    //     }\n    // }\n    //第一次进入阅读\n    var id = 1;\n    this.booksReadInfo[id] = {\n      book: id,\n      chapter: 1\n    };\n    this.getData(id, 1);\n    this.$store.dispatch('curChapter', 1);\n  },\n  mounted: function mounted() {\n    //因为要获取dom元素，所以不能放到created中\n    this.$refs.fz_size.style.fontSize = this.fz_size + 'px';\n  },\n  methods: {\n    //切换上下工具栏，如果字体面板显示点击也关闭\n    clickBar: function clickBar() {\n      this.$store.dispatch('toggleBar');\n      this.$store.state.font_panel = false;\n    },\n    //向上翻页\n    pageUp: function pageUp() {\n      var target = document.body.scrollTop - window.screen.height - 80;\n      this.startScroll(target, -20);\n    },\n    //向下翻页\n    pageDown: function pageDown() {\n      var target = document.body.scrollTop + window.screen.height - 80;\n      this.startScroll(target, 20);\n    },\n    startScroll: function startScroll(target, speed) {\n      var times = null;\n      times = setInterval(function () {\n        if (speed > 0) {\n          if (document.body.scrollTop <= target) {\n            document.body.scrollTop += speed;\n          }\n\n          if (document.body.scrollTop > target || document.body.scrollTop + window.screen.height >= document.body.scrollHeight) {\n            clearInterval(times);\n          }\n        } else {\n          if (document.body.scrollTop >= target) {\n            document.body.scrollTop += speed;\n          }\n\n          if (document.body.scrollTop < target || document.body.scrollTop <= 0) {\n            clearInterval(times);\n          }\n        }\n      }, 1);\n    },\n    getData: function getData(id, chapter) {\n      var _this = this;\n\n      this.loading = true;\n      debugger;\n\n      _axios.default.get(\"\".concat(this.common.api, \"/book?book=\").concat(id, \"&id=\").concat(chapter)).then(function (data) {\n        _this.loading = false; //获取完毕后隐藏动画\n\n        _this.title = data.data.title;\n        _this.content = data.data.content.split('-');\n      });\n\n      this.$store.state.windowHeight = window.screen.height;\n    },\n    prevChapter: function prevChapter() {\n      this.$store.dispatch('prevChapter');\n      this.saveBooksInfo();\n      setTimeout(function () {\n        document.body.scrollTop = 0;\n      }, 300);\n    },\n    //更换章节时保存阅读进度到localStorage\n    nextChapter: function nextChapter() {\n      this.$store.dispatch('nextChapter', 50);\n      this.saveBooksInfo();\n      setTimeout(function () {\n        document.body.scrollTop = 0;\n      }, 300);\n    },\n    saveBooksInfo: function saveBooksInfo() {\n      //可用localStorage保存每本小说阅读进度\n      var id = this.$route.params.id;\n      this.booksReadInfo[id] = {\n        book: id,\n        chapter: this.curChapter\n      };\n\n      _local.default.StorageSetter('bookreaderinfo', this.booksReadInfo);\n    },\n    page: function page(e) {\n      if (e.keyCode === 39) {\n        console.log(this.nextChapter);\n        this.nextChapter();\n      } else if (e.keyCode === 37) {\n        this.prevChapter();\n      }\n    }\n  },\n  computed: (0, _objectSpread2.default)({}, (0, _vuex.mapState)(['font_panel', 'bg_color', 'fz_size', 'bg_night', 'curChapter', 'windowHeight', 'list_panel'])),\n  watch: {\n    //监听fz_size的值更改背景色\n    fz_size: function fz_size(val, oldVal) {\n      this.$refs.fz_size.style.fontSize = val + 'px';\n\n      _local.default.StorageSetter('fz_size', val);\n    },\n    //监听当前章节的改变，保存到本地并获取数据\n    curChapter: function curChapter(val, oldVal) {\n      _local.default.StorageSetter('cur_chapter', val);\n\n      this.saveBooksInfo();\n      this.getData(this.$route.params.id, val);\n    }\n  }\n};\nexports.default = _default;",null]}