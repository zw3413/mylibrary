{"remainingRequest":"/Users/weizhang/JAVASHOP/mylibrary-ui/node_modules/thread-loader/dist/cjs.js!/Users/weizhang/JAVASHOP/mylibrary-ui/node_modules/babel-loader/lib/index.js!/Users/weizhang/JAVASHOP/mylibrary-ui/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/weizhang/JAVASHOP/mylibrary-ui/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/weizhang/JAVASHOP/mylibrary-ui/src/module/home/page/home.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/weizhang/JAVASHOP/mylibrary-ui/src/module/home/page/home.vue","mtime":1580222944231},{"path":"/Users/weizhang/JAVASHOP/mylibrary-ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/weizhang/JAVASHOP/mylibrary-ui/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/weizhang/JAVASHOP/mylibrary-ui/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/weizhang/JAVASHOP/mylibrary-ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/weizhang/JAVASHOP/mylibrary-ui/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); }\n\nfunction _iterableToArrayLimit(arr, i) { if (!(Symbol.iterator in Object(arr) || Object.prototype.toString.call(arr) === \"[object Arguments]\")) { return; } var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport bookCard from '../components/book/bookCard.vue';\nimport bookDetail from '../components/book/bookDetail.vue';\nimport bookPreview from '../components/book/bookPreview.vue';\nimport { parseParam } from '../../../utils/url';\nexport default {\n  components: {\n    bookCard: bookCard,\n    bookDetail: bookDetail,\n    // eslint-disable-next-line vue/no-unused-components\n    bookPreview: bookPreview\n  },\n  // name: 'app',\n  data: function data() {\n    return {\n      welcomeMsg: '资料检索服务',\n      condition: {\n        language: null,\n        author: null,\n        condition: null,\n        publishhouse: null,\n        tag: null\n      },\n      hint: {\n        name: '',\n        publishhouse: '',\n        author: '',\n        publishtimeRange: '',\n        language: '',\n        tag: '',\n        classification: '' // hasSource: false,\n        // hasBDSource: false,\n        // hasOtherSource: false\n\n      },\n      books: [],\n      currentBook: null,\n      urlContext: '',\n      // restBaseUrl: \"http://139.196.142.70:8090/mylibrary\",\n      restBaseUrl: 'http://139.196.142.70:8090/mylibrary',\n      fileBaseUrl: 'http://139.196.142.70/file/mylibrary/book/',\n      // pdfViewerUrl: \"http://localhost/#/viewer/pdf\",\n      pdfViewerUrl: 'http://139.196.142.70/pdf/web/viewer.html',\n      bookPreviewUrl: null,\n      expandSearchFlag: false,\n      activeIndex: 0,\n      page: '1',\n      pageSize: '5'\n    };\n  },\n  computed: {\n    noneFileUrl: function noneFileUrl() {\n      return this.fileBaseUrl + 'noneFile.png';\n    },\n    headerHight: function headerHight() {\n      return this.expandSearchFlag ? '120px' : '60px';\n    },\n    expandIconClass: function expandIconClass() {\n      return this.expandSearchFlag ? 'el-icon-caret-top' : 'el-icon-caret-bottom';\n    },\n    restUrl: function restUrl() {\n      return {\n        book: this.restBaseUrl + '/book'\n      };\n    },\n    host: function host() {\n      return window.location.host;\n    },\n    pathname: function pathname() {\n      return window.location.pathname;\n    },\n    hash: function hash() {\n      return window.location.hash;\n    },\n    href: function href() {\n      return window.location.href;\n    } // ,\n    // pdfViewerUrl: function() {\n    //   return this.href + 'viewer/pdf'\n    // }\n\n  },\n  watch: {\n    bookPreviewUrl: function bookPreviewUrl() {\n      window['bookpreview'].location.reload();\n    }\n  },\n  created: function created() {\n    this.fetchConditions();\n    this.initParam();\n  },\n  mounted: function mounted() {\n    this.search();\n  },\n  methods: {\n    initParam: function initParam() {},\n    search: function search(param) {\n      var _this2 = this;\n\n      // alert(this.hint.publicationdateRange)\n      this.hint.page = this.page;\n      this.hint.pageSize = this.pageSize;\n      fetch(this.restUrl.book + \"?\" + parseParam(this.hint) //, {\n      //   method: 'get',\n      //   body: JSON.stringify(this.hint),\n      //   headers: {\n      //     // 'user-agent': 'Mozilla/4.0 MDN Example',\n      //     'content-type': 'application/json'\n      //   }\n      // }\n      ).then(function (resp) {\n        return resp.json();\n      }).then(function (json) {\n        // if(this.books.length>0 ){\n        var _this = _this2;\n\n        if (!'loadMore' === param) {\n          _this2.books = [];\n        }\n\n        json.forEach(function (v) {\n          _this.books.push(v);\n        }); // }\n        // this.books = json;\n      });\n    },\n    loadNextPageBooks: function loadNextPageBooks() {\n      var cp = eval(this.page);\n      this.page = ++cp + '';\n      this.search('loadMore');\n    },\n    setCurrentBook: function setCurrentBook(book, index) {\n      this.activeIndex = index; // 处理classification和tag\n      // var classification = book.classification;\n      // book.absolutePath = book.filepath?this.fileBaseUrl + book.filepath.trim():'';\n\n      this.bookPreviewUrl = this.pdfViewerUrl + '?file=' + this.fileBaseUrl + book.filepath.trim();\n      this.currentBook = this.books[index];\n    },\n    toggleExpandSearch: function toggleExpandSearch() {\n      this.expandSearchFlag = !this.expandSearchFlag;\n    },\n    saveCurrentBook: function saveCurrentBook(book) {\n      if (book) {\n        debugger; // this.setCurrentBook(book);\n\n        Object.assign(this.books[this.activeIndex], book); // this.books[this.activeIndex]=book;\n      } // 上传currentBook\n\n\n      var url = this.restBaseUrl + '/book';\n      fetch(url, {\n        method: 'put',\n        body: JSON.stringify(this.currentBook),\n        headers: {\n          // 'user-agent': 'Mozilla/4.0 MDN Example',\n          'content-type': 'application/json'\n        }\n      }).then(function (resp) {\n        return resp.json();\n      }).then(function (json) {\n        console.log(json);\n      });\n      console.log('saveCurrentBook');\n      console.log(this.currentBook);\n    },\n    fetchConditions: function fetchConditions() {\n      var _this3 = this;\n\n      var url = this.restBaseUrl + '/table?name=';\n\n      var _this = this; // 出版社列表\n\n\n      fetch(url + 'mlb_book_publishhouse').then(function (resp) {\n        return resp.json();\n      }).then(function (json) {\n        var publishhouse = [];\n        json.forEach(function (v) {\n          publishhouse.push({\n            label: v ? v.name : '',\n            value: v ? v.name : ''\n          }); // publishhouse.push(v.name)\n        });\n        _this.condition.publishhouse = publishhouse;\n      }); // 分类\n\n      fetch(url + 'mlb_book_classification').then(function (resp) {\n        return resp.json();\n      }).then(function (json) {\n        var _ = _this3._;\n        var map = {}; // 第一次解构\n\n        _.forEach(json, function (v, i, c) {\n          if (v && v.name) {\n            if (v.name.indexOf('/') > 0) {\n              var _v$name$split = v.name.split('/'),\n                  _v$name$split2 = _slicedToArray(_v$name$split, 2),\n                  c1 = _v$name$split2[0],\n                  c2 = _v$name$split2[1];\n\n              if (map[c1]) {\n                map[c1].add(c2);\n              } else {\n                map[c1] = new Set([c2]);\n              }\n            }\n          }\n        });\n\n        var arr = []; // 第二次重构\n\n        _.forEach(map, function (v, k, c) {\n          var o = {\n            value: k,\n            label: k,\n            children: []\n          };\n          var c2 = Array.from(v);\n\n          _.forEach(c2, function (v, i) {\n            var o1 = {\n              value: v,\n              label: v\n            };\n            o.children.push(o1);\n          });\n\n          arr.push(o);\n        });\n\n        _this3.condition.classification = arr;\n      }); // 语言\n\n      fetch(url + 'mlb_book_language').then(function (resp) {\n        return resp.json();\n      }).then(function (json) {\n        var language = [];\n        json.forEach(function (v) {\n          if (v) {\n            language.push({\n              label: v.name,\n              value: v.name\n            });\n          } // language.push(v.name)\n\n        });\n        _this.condition.language = language;\n      }); // tag\n\n      fetch(url + 'mlb_book_tag').then(function (resp) {\n        return resp.json();\n      }).then(function (json) {\n        var tag = [];\n        json.forEach(function (v) {\n          tag.push({\n            label: v.name,\n            value: v.name\n          }); // tag.push(v.name)\n        });\n        _this.condition.tag = tag;\n      }); // author\n\n      fetch(url + 'mlb_book_author').then(function (resp) {\n        return resp.json();\n      }).then(function (json) {\n        var author = [];\n        json.forEach(function (v) {\n          // publisher.push({label:v.name,value:v.name})\n          author.push({\n            label: v.name,\n            value: v.name\n          });\n        });\n        _this.condition.author = author;\n      });\n    }\n  }\n};",null]}