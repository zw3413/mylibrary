{"remainingRequest":"/Users/weizhang/JAVASHOP/mylibrary-ui/node_modules/thread-loader/dist/cjs.js!/Users/weizhang/JAVASHOP/mylibrary-ui/node_modules/babel-loader/lib/index.js!/Users/weizhang/JAVASHOP/mylibrary-ui/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/weizhang/JAVASHOP/mylibrary-ui/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/weizhang/JAVASHOP/mylibrary-ui/src/module/home/components/book/bookPreview.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/weizhang/JAVASHOP/mylibrary-ui/src/module/home/components/book/bookPreview.vue","mtime":1579741812132},{"path":"/Users/weizhang/JAVASHOP/mylibrary-ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/weizhang/JAVASHOP/mylibrary-ui/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/weizhang/JAVASHOP/mylibrary-ui/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/weizhang/JAVASHOP/mylibrary-ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/weizhang/JAVASHOP/mylibrary-ui/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n// 属性：\n// author:lx 2018-08-06\nimport pdfjsLib from 'pdfjs-dist';\nimport $ from 'jquery';\nexport default {\n  name: 'ReadByPdf',\n  props: {\n    url: {\n      type: String\n    }\n  },\n  data: function data() {\n    return {\n      theReadOnline: {\n        current: 1,\n        numPages: 0\n      }\n    };\n  },\n  computed: {\n    currentUrl: function currentUrl() {\n      return this.url;\n    }\n  },\n  watch: {\n    currentUrl: function currentUrl() {\n      $(document.getElementById('div_read_area')).html('');\n      this.loadPDFForTheDocument(1);\n    }\n  },\n  mounted: function mounted() {\n    this.initThePDFJSLIB();\n    this.watchTheReadScroll();\n    this.loadPDFForTheDocument(1);\n  },\n  methods: {\n    // 初始化pdfjs\n    initThePDFJSLIB: function initThePDFJSLIB() {\n      pdfjsLib.GlobalWorkerOptions.workerSrc = 'pdfjs-dist/build/pdf.worker.js';\n    },\n    // 根据页码获取pdf内容\n    loadPDFForTheDocument: function loadPDFForTheDocument(index) {\n      var _this = this;\n\n      // 实例化pdfjs\n      pdfjsLib.getDocument(this.url).then(function (pdf) {\n        // 通过页码获取每页内容\n        pdf.getPage(index).then(function (page) {\n          // 获得总页数\n          _this.theReadOnline.numPages = pdf.numPages; // 设置页面显示倍数 842×595\n          // let _clientWidth = document.documentElement.clientWidth * 0.618\n          // let view = _clientWidth % 842 > 0 ? 1.33 : 1\n\n          var view = 0.85; // 实例化画布\n\n          var canvas = document.createElement('canvas');\n          var context = canvas.getContext('2d');\n          var dpr = window.devicePixelRatio || 1;\n          var bsr = context.webkitBackingStorePixelRatio || context.mozBackingStorePixelRatio || context.msBackingStorePixelRatio || context.oBackingStorePixelRatio || context.backingStorePixelRatio || 1;\n          var ratio = dpr / bsr;\n          ratio = 1;\n          var viewport = page.getViewport(view);\n          canvas.width = viewport.width * ratio;\n          canvas.height = viewport.height * ratio; // canvas.style.width = viewport.width + 'px'\n          // canvas.style.height = viewport.height + 'px'\n          // context.setTransform(ratio, 0, 0, ratio, 0, 0)\n\n          var renderContext = {\n            canvasContext: context,\n            viewport: viewport\n          }; // 追加上新的一页空间\n\n          document.getElementById('div_read_area').appendChild(canvas); // 赋值上显示内容\n\n          page.render(renderContext).then(function () {});\n        });\n      }).catch(function (err) {\n        console.log(err);\n      });\n    },\n    watchTheReadScroll: function watchTheReadScroll() {\n      var _theVue = this; // 获取节点\n\n\n      var _scrollContent = document.getElementById('div_read_area_scrool'); // 绑定事件\n\n\n      _scrollContent.addEventListener('scroll', function () {\n        var viewH, contentH, scrollTop;\n        viewH = $(this).height();\n        contentH = $(this).get(0).scrollHeight;\n        scrollTop = $(this).scrollTop(); // 后期改成传递给父级\n\n        if (scrollTop / (contentH - viewH) >= 1) {\n          // 到达底部时,加载新内容\n          _theVue.theReadOnline.current++;\n\n          if (_theVue.theReadOnline.current <= _theVue.theReadOnline.numPages) {\n            _theVue.loadPDFForTheDocument(_theVue.theReadOnline.current);\n          }\n        }\n      });\n    }\n  }\n};",null]}